<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mapi::Pst
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mapi::Pst";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mapi.html" title="Mapi (module)">Mapi</a></span></span>
     &raquo; 
    <span class="title">Pst</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mapi::Pst
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mapi::Pst</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Enumerable</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mapi/pst.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Pst/Attachment.html" title="Mapi::Pst::Attachment (class)">Attachment</a></span>, <span class='object_link'><a href="Pst/AttachmentTable.html" title="Mapi::Pst::AttachmentTable (class)">AttachmentTable</a></span>, <span class='object_link'><a href="Pst/BlockParser.html" title="Mapi::Pst::BlockParser (class)">BlockParser</a></span>, <span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span>, <span class='object_link'><a href="Pst/CompressibleEncryption.html" title="Mapi::Pst::CompressibleEncryption (class)">CompressibleEncryption</a></span>, <span class='object_link'><a href="Pst/FormatError.html" title="Mapi::Pst::FormatError (class)">FormatError</a></span>, <span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span>, <span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span>, <span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span>, <span class='object_link'><a href="Pst/RawPropertyStore.html" title="Mapi::Pst::RawPropertyStore (class)">RawPropertyStore</a></span>, <span class='object_link'><a href="Pst/RawPropertyStoreTable.html" title="Mapi::Pst::RawPropertyStoreTable (class)">RawPropertyStoreTable</a></span>, <span class='object_link'><a href="Pst/Recipient.html" title="Mapi::Pst::Recipient (class)">Recipient</a></span>, <span class='object_link'><a href="Pst/RecipientTable.html" title="Mapi::Pst::RecipientTable (class)">RecipientTable</a></span>, <span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="ToTree-constant" class="">ToTree =
          <div class="docstring">
  <div class="discussion">
    
<p>this is the index and desc record loading code</p>
<hr>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span></pre></dd>
      
        <dt id="ITEM_COUNT_OFFSET-constant" class="">ITEM_COUNT_OFFSET =
          <div class="docstring">
  <div class="discussion">
    
<p>more constants from libpst.c these relate to the index block</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x1f0</span></pre></dd>
      
        <dt id="LEVEL_INDICATOR_OFFSET-constant" class="">LEVEL_INDICATOR_OFFSET =
          <div class="docstring">
  <div class="discussion">
    
<p>count byte</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x1f3</span></pre></dd>
      
        <dt id="BACKLINK_OFFSET-constant" class="">BACKLINK_OFFSET =
          <div class="docstring">
  <div class="discussion">
    
<p>node or leaf</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x1f8</span></pre></dd>
      
        <dt id="ITEM_COUNT_OFFSET_64-constant" class="">ITEM_COUNT_OFFSET_64 =
          <div class="docstring">
  <div class="discussion">
    
<p>mostly guesses.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x1e8</span></pre></dd>
      
        <dt id="LEVEL_INDICATOR_OFFSET_64-constant" class="">LEVEL_INDICATOR_OFFSET_64 =
          <div class="docstring">
  <div class="discussion">
    
<p>diff of 3 between these 2 as above…</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x1eb</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#blocks-instance_method" title="#blocks (instance method)">#<strong>blocks</strong>  &#x21d2; Array&lt;BlockPtr&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#header-instance_method" title="#header (instance method)">#<strong>header</strong>  &#x21d2; Header </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#io-instance_method" title="#io (instance method)">#<strong>io</strong>  &#x21d2; IO </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#nodes-instance_method" title="#nodes (instance method)">#<strong>nodes</strong>  &#x21d2; Array&lt;NodePtr&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#special_folder_ids-instance_method" title="#special_folder_ids (instance method)">#<strong>special_folder_ids</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_property_set-class_method" title="make_property_set (class method)">.<strong>make_property_set</strong>(property_list)  &#x21d2; PropertySet </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#split_per-class_method" title="split_per (class method)">.<strong>split_per</strong>(str, size, count)  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unpack-class_method" title="unpack (class method)">.<strong>unpack</strong>(str, unpack_spec)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>unfortunately there is no Q analogue which is little endian only.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#block_from_id-instance_method" title="#block_from_id (instance method)">#<strong>block_from_id</strong>(id)  &#x21d2; BlockPtr </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>most access to idx objects will use this function.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dump_debug_info-instance_method" title="#dump_debug_info (instance method)">#<strong>dump_debug_info</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>other random code —————————————————————————-.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encrypted%3F-instance_method" title="#encrypted? (instance method)">#<strong>encrypted?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_local_node_list_of_sub_block_to-instance_method" title="#get_local_node_list_of_sub_block_to (instance method)">#<strong>get_local_node_list_of_sub_block_to</strong>(sub_block_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>for debug.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_local_node_list_to-instance_method" title="#get_local_node_list_to (instance method)">#<strong>get_local_node_list_to</strong>(node_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>for debug.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(io)  &#x21d2; Pst </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to * pst_open * pst_load_index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is64-instance_method" title="#is64 (instance method)">#<strong>is64</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_block_btree-instance_method" title="#load_block_btree (instance method)">#<strong>load_block_btree</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to * _pst_build_id_ptr.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_block_tree-instance_method" title="#load_block_tree (instance method)">#<strong>load_block_tree</strong>(offset, linku1, start_val)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>load the flat idx table, which maps ids to file ranges.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_main_block_to-instance_method" title="#load_main_block_to (instance method)">#<strong>load_main_block_to</strong>(block_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_node_btree-instance_method" title="#load_node_btree (instance method)">#<strong>load_node_btree</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to * _pst_build_desc_ptr * record_descriptor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_node_main_data_to-instance_method" title="#load_node_main_data_to (instance method)">#<strong>load_node_main_data_to</strong>(node_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_node_sub_data_to-instance_method" title="#load_node_sub_data_to (instance method)">#<strong>load_node_sub_data_to</strong>(node_id, local_node_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_node_tree-instance_method" title="#load_node_tree (instance method)">#<strong>load_node_tree</strong>(offset, linku1, start_val)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>load the flat list of desc records recursively.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_sub_block_to-instance_method" title="#load_sub_block_to (instance method)">#<strong>load_sub_block_to</strong>(sub_block_id, local_node_id, list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_xattrib-instance_method" title="#load_xattrib (instance method)">#<strong>load_xattrib</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to * pst_load_extended_attributes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#node_from_id-instance_method" title="#node_from_id (instance method)">#<strong>node_from_id</strong>(id)  &#x21d2; NodePtr </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>as for idx.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pst_parse_item-instance_method" title="#pst_parse_item (instance method)">#<strong>pst_parse_item</strong>(node)  &#x21d2; Item </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to * _pst_parse_item.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pst_read_block_size-instance_method" title="#pst_read_block_size (instance method)">#<strong>pst_read_block_size</strong>(offset, size, decrypt = true)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>corresponds to: * _pst_read_block_size * _pst_read_block ?? * _pst_ff_getIDblock_dec ?? * _pst_ff_getIDblock ??.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root-instance_method" title="#root (instance method)">#<strong>root</strong>  &#x21d2; Item </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root_desc-instance_method" title="#root_desc (instance method)">#<strong>root_desc</strong>  &#x21d2; NodePtr </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root_item-instance_method" title="#root_item (instance method)">#<strong>root_item</strong>  &#x21d2; Item </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#warn-instance_method" title="#warn (instance method)">#<strong>warn</strong>(s)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>until i properly fix logging…</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(io)  &#x21d2; <tt><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to</p>
<ul><li>
<p>pst_open</p>
</li><li>
<p>pst_load_index</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>io</span>
      
      
        <span class='type'>(<tt>IO</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/FormatError.html" title="Mapi::Pst::FormatError (class)">FormatError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295
296
297
298
299
300
301
302
303
304
305
306
307</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_io'>io</span>
	<span class='ivar'>@io</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span>
	<span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>
	<span class='ivar'>@header</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/Header.html#initialize-instance_method" title="Mapi::Pst::Header#initialize (method)">new</a></span></span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/Header.html#SIZE-constant" title="Mapi::Pst::Header::SIZE (constant)">SIZE</a></span></span><span class='rparen'>)</span>

	<span class='comment'># would prefer this to be in Header#validate, but it doesn&#39;t have the io size.
</span>	<span class='comment'># should perhaps downgrade this to just be a warning...
</span>	<span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Pst/FormatError.html" title="Mapi::Pst::FormatError (class)">FormatError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>header size field invalid (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> != </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>

	<span class='id identifier rubyid_load_block_btree'>load_block_btree</span>
	<span class='id identifier rubyid_load_node_btree'>load_node_btree</span>
	<span class='id identifier rubyid_load_xattrib'>load_xattrib</span>

	<span class='ivar'>@special_folder_ids</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="blocks-instance_method">
  
    #<strong>blocks</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span>&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


282
283
284</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 282</span>

<span class='kw'>def</span> <span class='id identifier rubyid_blocks'>blocks</span>
  <span class='ivar'>@blocks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="header-instance_method">
  
    #<strong>header</strong>  &#x21d2; <tt><span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_header'>header</span>
  <span class='ivar'>@header</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="io-instance_method">
  
    #<strong>io</strong>  &#x21d2; <tt>IO</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>IO</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 278</span>

<span class='kw'>def</span> <span class='id identifier rubyid_io'>io</span>
  <span class='ivar'>@io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="nodes-instance_method">
  
    #<strong>nodes</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span>&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 284</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nodes'>nodes</span>
  <span class='ivar'>@nodes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="special_folder_ids-instance_method">
  
    #<strong>special_folder_ids</strong>  &#x21d2; <tt>Hash</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_special_folder_ids'>special_folder_ids</span>
  <span class='ivar'>@special_folder_ids</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="make_property_set-class_method">
  
    .<strong>make_property_set</strong>(property_list)  &#x21d2; <tt><span class='object_link'><a href="PropertySet.html" title="Mapi::PropertySet (class)">PropertySet</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property_list</span>
      
      
        <span class='type'>(<tt>Array&lt;Array(Integer, Integer, Object)&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="PropertySet.html" title="Mapi::PropertySet (class)">PropertySet</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1524
1525
1526
1527
1528
1529</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1524</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_property_set'>make_property_set</span> <span class='id identifier rubyid_property_list'>property_list</span>
	<span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='id identifier rubyid_property_list'>property_list</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='op'>|</span>
		<span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='const'><span class='object_link'><a href="PropertySet.html" title="Mapi::PropertySet (class)">PropertySet</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PropertySet/Key.html" title="Mapi::PropertySet::Key (class)">Key</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="PropertySet/Key.html#initialize-instance_method" title="Mapi::PropertySet::Key#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span>
	<span class='kw'>end</span>
	<span class='const'><span class='object_link'><a href="PropertySet.html" title="Mapi::PropertySet (class)">PropertySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="PropertySet.html#initialize-instance_method" title="Mapi::PropertySet#initialize (method)">new</a></span></span> <span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="split_per-class_method">
  
    .<strong>split_per</strong>(str, size, count)  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>size</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>count</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 110</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_split_per'>split_per</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span>
	<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>/</span> <span class='id identifier rubyid_size'>size</span> <span class='kw'>if</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>&lt;</span> <span class='int'>0</span>
	<span class='id identifier rubyid_list'>list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
	<span class='id identifier rubyid_list'>list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unpack-class_method">
  
    .<strong>unpack</strong>(str, unpack_spec)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>unfortunately there is no Q analogue which is little endian only. this translates T as an unsigned quad word, little endian byte order, to not pollute the rest of the code.</p>

<p>didn&#39;t want to override String#unpack, cause its too hacky, and incomplete.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>unpack_spec</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 78</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_unpack_spec'>unpack_spec</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_unpack_spec'>unpack_spec</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_unpack_spec'>unpack_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>T</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
	<span class='ivar'>@unpack_cache</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
	<span class='id identifier rubyid_t_offsets'>t_offsets</span><span class='comma'>,</span> <span class='id identifier rubyid_new_spec'>new_spec</span> <span class='op'>=</span> <span class='ivar'>@unpack_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_unpack_spec'>unpack_spec</span><span class='rbracket'>]</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_t_offsets'>t_offsets</span>
		<span class='id identifier rubyid_t_offsets'>t_offsets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='int'>0</span>
		<span class='id identifier rubyid_new_spec'>new_spec</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
		<span class='id identifier rubyid_unpack_spec'>unpack_spec</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([^\d])_?(\*|\d+)?</span><span class='regexp_end'>/o</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
			<span class='id identifier rubyid_num_elems'>num_elems</span> <span class='op'>=</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='lparen'>(</span><span class='backref'>$2</span> <span class='op'>||</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
			<span class='kw'>if</span> <span class='backref'>$1</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>T</span><span class='tstring_end'>&#39;</span></span>
				<span class='id identifier rubyid_num_elems'>num_elems</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_t_offsets'>t_offsets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>+</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span>
				<span class='id identifier rubyid_new_spec'>new_spec</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_num_elems'>num_elems</span> <span class='op'>*</span> <span class='int'>2</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
			<span class='kw'>else</span>
				<span class='id identifier rubyid_new_spec'>new_spec</span> <span class='op'>&lt;&lt;</span> <span class='gvar'>$~</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
			<span class='kw'>end</span>
			<span class='id identifier rubyid_offset'>offset</span> <span class='op'>+=</span> <span class='id identifier rubyid_num_elems'>num_elems</span>
		<span class='kw'>end</span>
		<span class='ivar'>@unpack_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_unpack_spec'>unpack_spec</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_t_offsets'>t_offsets</span><span class='comma'>,</span> <span class='id identifier rubyid_new_spec'>new_spec</span><span class='rbracket'>]</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_new_spec'>new_spec</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_t_offsets'>t_offsets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>|</span>
		<span class='id identifier rubyid_low'>low</span><span class='comma'>,</span> <span class='id identifier rubyid_high'>high</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_low'>low</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_high'>high</span> <span class='op'>?</span> <span class='id identifier rubyid_low'>low</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_high'>high</span> <span class='op'>&lt;&lt;</span> <span class='int'>32</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_a'>a</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="block_from_id-instance_method">
  
    #<strong>block_from_id</strong>(id)  &#x21d2; <tt><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>most access to idx objects will use this function</p>

<p>corresponds to</p>
<ul><li>
<p>_pst_getID</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


563
564
565</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 563</span>

<span class='kw'>def</span> <span class='id identifier rubyid_block_from_id'>block_from_id</span> <span class='id identifier rubyid_id'>id</span>
	<span class='ivar'>@block_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span> <span class='op'>&amp;</span> <span class='op'>~</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dump_debug_info-instance_method">
  
    #<strong>dump_debug_info</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>other random code</p>
<hr>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1720</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dump_debug_info'>dump_debug_info</span>
	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>* pst header</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_header'>header</span>

<span class='embdoc_beg'>=begin
</span><span class='embdoc'>Looking at the output of this, for blank-o1997.pst, i see this part:
</span><span class='embdoc'>...
</span><span class='embdoc'>- (26624,516) desc block data (overlap of 4 bytes)
</span><span class='embdoc'>- (27136,516) desc block data (gap of 508 bytes)
</span><span class='embdoc'>- (28160,516) desc block data (gap of 2620 bytes)
</span><span class='embdoc'>...
</span><span class='embdoc'>
</span><span class='embdoc'>which confirms my belief that the block size for idx and desc is more likely 512
</span><span class='embdoc_end'>=end
</span>	<span class='kw'>if</span> <span class='int'>0</span> <span class='op'>+</span> <span class='int'>0</span> <span class='op'>==</span> <span class='int'>0</span>
		<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>* file range usage</span><span class='tstring_end'>&#39;</span></span>
		<span class='id identifier rubyid_file_ranges'>file_ranges</span> <span class='op'>=</span>
			<span class='comment'># these 3 things, should account for most of the data in the file.
</span>			<span class='lbracket'>[</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/Header.html" title="Mapi::Pst::Header (class)">Header</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/Header.html#SIZE-constant" title="Mapi::Pst::Header::SIZE (constant)">SIZE</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pst file header</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>+</span>
			<span class='ivar'>@block_offsets</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#BLOCK_SIZE-constant" title="Mapi::Pst::BlockPtr::BLOCK_SIZE (constant)">BLOCK_SIZE</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>block data</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='op'>+</span>
			<span class='ivar'>@node_offsets</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#BLOCK_SIZE-constant" title="Mapi::Pst::NodePtr::BLOCK_SIZE (constant)">BLOCK_SIZE</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>node data</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='op'>+</span>
			<span class='ivar'>@blocks</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>idx id=0x%x (%s)</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
		<span class='lparen'>(</span><span class='id identifier rubyid_file_ranges'>file_ranges</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='rbrace'>}</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_enum'>to_enum</span><span class='lparen'>(</span><span class='symbol'>:each_cons</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_next_record'>next_record</span><span class='op'>|</span>
			<span class='comment'># i think there is a padding of the size out to 64 bytes
</span>			<span class='comment'># which is equivalent to padding out the final offset, because i think the offset is 
</span>			<span class='comment'># similarly oriented
</span>			<span class='id identifier rubyid_pad_amount'>pad_amount</span> <span class='op'>=</span> <span class='int'>64</span>
			<span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>i am wrong about the offset padding</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>%</span> <span class='id identifier rubyid_pad_amount'>pad_amount</span> <span class='op'>!=</span> <span class='int'>0</span>
			<span class='comment'># so, assuming i&#39;m not wrong about that, then we can calculate how much padding is needed.
</span>			<span class='id identifier rubyid_pad'>pad</span> <span class='op'>=</span> <span class='id identifier rubyid_pad_amount'>pad_amount</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span> <span class='op'>%</span> <span class='id identifier rubyid_pad_amount'>pad_amount</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_pad'>pad</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_pad'>pad</span> <span class='op'>==</span> <span class='id identifier rubyid_pad_amount'>pad_amount</span>
			<span class='id identifier rubyid_gap'>gap</span> <span class='op'>=</span> <span class='id identifier rubyid_next_record'>next_record</span> <span class='op'>?</span> <span class='id identifier rubyid_next_record'>next_record</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>+</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>+</span> <span class='id identifier rubyid_pad'>pad</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='int'>0</span>
			<span class='id identifier rubyid_extra'>extra</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_gap'>gap</span> <span class='op'>&lt;=&gt;</span> <span class='int'>0</span>
				<span class='kw'>when</span> <span class='op'>-</span><span class='int'>1</span><span class='semicolon'>;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overlap of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gap'>gap</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='embexpr_end'>}</span><span class='tstring_content'> bytes)</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
				<span class='kw'>when</span>  <span class='int'>0</span><span class='semicolon'>;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
				<span class='kw'>when</span> <span class='int'>+1</span><span class='semicolon'>;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gap of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gap'>gap</span><span class='embexpr_end'>}</span><span class='tstring_content'> bytes</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
			<span class='kw'>end</span>
			<span class='comment'># how about we check that padding
</span>			<span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>+</span> <span class='id identifier rubyid_size'>size</span>
			<span class='id identifier rubyid_pad_bytes'>pad_bytes</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_pad'>pad</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_extra'>extra</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>padding not all zero</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_pad_bytes'>pad_bytes</span> <span class='op'>==</span> <span class='int'>0</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>*</span> <span class='id identifier rubyid_pad'>pad</span>
			<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_offset'>offset</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>+</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pad'>pad</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> [</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_extra'>extra</span> <span class='op'>*</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>]</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>

	<span class='comment'># i think the idea of the idx, and indeed the idx2, is just to be able to
</span>	<span class='comment'># refer to data indirectly, which means it can get moved around, and you just update
</span>	<span class='comment'># the idx table. it is simply a list of file offsets and sizes.
</span>	<span class='comment'># not sure i get how id2 plays into it though....
</span>	<span class='comment'># the sizes seem to be all even. is that a co-incidence? and the ids are all even. that
</span>	<span class='comment'># seems to be related to something else (see the (id &amp; 2) == 1 stuff)
</span>	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>* idx entries</span><span class='tstring_end'>&#39;</span></span>
	<span class='ivar'>@blocks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

	<span class='comment'># if you look at the desc tree, you notice a few things:
</span>	<span class='comment'># 1. there is a desc that seems to be the parent of all the folders, messages etc.
</span>	<span class='comment'>#    it is the one whose parent is itself.
</span>	<span class='comment'>#    one of its children is referenced as the subtree_entryid of the first desc item,
</span>	<span class='comment'>#    the root.
</span>	<span class='comment'># 2. typically only 2 types of desc records have idx2_id != 0. messages themselves,
</span>	<span class='comment'>#    and the desc with id = 0x61 - the xattrib container. everything else uses the
</span>	<span class='comment'>#    regular ids to find its data. i think it should be reframed as small blocks and
</span>	<span class='comment'>#    big blocks, but i&#39;ll look into it more.
</span>	<span class='comment'>#
</span>	<span class='comment'># idx_id and idx2_id are for getting to the data. desc_id and parent_desc_id just define
</span>	<span class='comment'># the parent &lt;-&gt; child relationship, and the desc_ids are how the items are referred to in
</span>	<span class='comment'># entryids.
</span>	<span class='comment'># note that these aren&#39;t unique! eg for 0, 4 etc. i expect these&#39;d never change, as the ids
</span>	<span class='comment'># are stored in entryids. whereas the idx and idx2 could be a bit more volatile.
</span>	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>* node tree</span><span class='tstring_end'>&#39;</span></span>
	<span class='comment'># make a dummy root hold everything just for convenience
</span>	<span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/NodePtr.html#initialize-instance_method" title="Mapi::Pst::NodePtr#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>def</span> <span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Pst::Root&gt;</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span>
	<span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span> <span class='ivar'>@orphans</span>
	<span class='comment'># this still loads the whole thing as a string for gsub. should use directo output io
</span>	<span class='comment'># version.
</span>	<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_tree'>to_tree</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>, (parent_node_id|idx2_id)=0x0(?!\d)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

	<span class='comment'># this is fairly easy to understand, its just an attempt to display the pst items in a tree form
</span>	<span class='comment'># which resembles what you&#39;d see in outlook.
</span>	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>* item tree</span><span class='tstring_end'>&#39;</span></span>
	<span class='comment'># now streams directly
</span>	<span class='id identifier rubyid_root_item'>root_item</span><span class='period'>.</span><span class='id identifier rubyid_to_tree'>to_tree</span> <span class='const'>STDOUT</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each-instance_method">
  
    #<strong>each</strong>(&amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1825
1826
1827
1828
1829</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1825</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span>
	<span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each_recursive'>each_recursive</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="encrypted?-instance_method">
  
    #<strong>encrypted?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypted?'>encrypted?</span>
	<span class='ivar'>@header</span><span class='period'>.</span><span class='id identifier rubyid_encrypted?'>encrypted?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_local_node_list_of_sub_block_to-instance_method">
  
    #<strong>get_local_node_list_of_sub_block_to</strong>(sub_block_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>for debug</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sub_block_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 726</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_local_node_list_of_sub_block_to'>get_local_node_list_of_sub_block_to</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span> <span class='op'>==</span> <span class='int'>0</span>

	<span class='id identifier rubyid_sub_block'>sub_block</span> <span class='op'>=</span> <span class='id identifier rubyid_block_from_id'>block_from_id</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span>
	<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WALK</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='id identifier rubyid_sub_block_id'>sub_block_id</span><span class='comma'>,</span><span class='id identifier rubyid_sub_block'>sub_block</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>must not be data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_data?'>data?</span>

	<span class='comment'># SLBLOCK or SIBLOCK
</span>	<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>

	<span class='id identifier rubyid_btype'>btype</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>btype != 2</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_btype'>btype</span> <span class='op'>!=</span> <span class='int'>2</span>

	<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='kw'>case</span> <span class='id identifier rubyid_level'>level</span>
	<span class='kw'>when</span> <span class='int'>0</span> <span class='comment'># SLBLOCK
</span>		<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>v</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_sl_node_id'>sl_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_sl_block_id'>sl_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_sl_sub_block_id'>sl_sub_block_id</span> <span class='op'>=</span> <span class='lparen'>(</span>
				<span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>24</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>24</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>12</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>12</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='rparen'>)</span>

			<span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_sl_node_id'>sl_node_id</span> <span class='op'>&amp;</span> <span class='int'>0xffffffff</span><span class='rparen'>)</span>
			
			<span class='id identifier rubyid_get_local_node_list_of_sub_block_to'>get_local_node_list_of_sub_block_to</span> <span class='id identifier rubyid_sl_sub_block_id'>sl_sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
		<span class='kw'>end</span>
	<span class='kw'>when</span> <span class='int'>1</span> <span class='comment'># SIBLOCK
</span>		<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>v</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_si_node_id'>si_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_si_block_id'>si_block_id</span> <span class='op'>=</span> <span class='lparen'>(</span>
				<span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>16</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>8</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='rparen'>)</span>

			<span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_si_node_id'>si_node_id</span> <span class='op'>&amp;</span> <span class='int'>0xffffffff</span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>level unk</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_local_node_list_to-instance_method">
  
    #<strong>get_local_node_list_to</strong>(node_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>for debug</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>node_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


717
718
719
720</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 717</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_local_node_list_to'>get_local_node_list_to</span> <span class='id identifier rubyid_node_id'>node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_node_from_id'>node_from_id</span> <span class='id identifier rubyid_node_id'>node_id</span>
	<span class='id identifier rubyid_get_local_node_list_of_sub_block_to'>get_local_node_list_of_sub_block_to</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_sub_block_id'>sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1835
1836
1837</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1835</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
	<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Pst name=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> io=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is64-instance_method">
  
    #<strong>is64</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


607
608
609</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 607</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is64'>is64</span>
	<span class='ivar'>@header</span><span class='period'>.</span><span class='id identifier rubyid_version_2003?'>version_2003?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_block_btree-instance_method">
  
    #<strong>load_block_btree</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to</p>
<ul><li>
<p>_pst_build_id_ptr</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


495
496
497
498
499
500
501
502
503
504
505
506
507</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 495</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_block_btree'>load_block_btree</span>
	<span class='ivar'>@blocks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='ivar'>@block_offsets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_load_block_tree'>load_block_tree</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_block_btree'>block_btree</span><span class='comma'>,</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_block_btree_count'>block_btree_count</span><span class='comma'>,</span> <span class='int'>0</span>

	<span class='comment'># we&#39;ll typically be accessing by id, so create a hash as a lookup cache
</span>	<span class='ivar'>@block_from_id</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
		<span class='ivar'>@blocks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
		<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>&amp;</span> <span class='op'>~</span><span class='int'>1</span>
		<span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>there are duplicate idx records with id </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@block_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
		<span class='ivar'>@block_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_idx'>idx</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_block_tree-instance_method">
  
    #<strong>load_block_tree</strong>(offset, linku1, start_val)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>load the flat idx table, which maps ids to file ranges. this is the recursive helper</p>

<p>corresponds to</p>
<ul><li>
<p>_pst_build_id_ptr</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 513</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_block_tree'>load_block_tree</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_linku1'>linku1</span><span class='comma'>,</span> <span class='id identifier rubyid_start_val'>start_val</span>
	<span class='ivar'>@block_offsets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_offset'>offset</span>

	<span class='comment'>#_pst_read_block_size(pf, offset, BLOCK_SIZE, &amp;buf, 0, 0) &lt; BLOCK_SIZE)
</span>	<span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_pst_read_block_size'>pst_read_block_size</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#BLOCK_SIZE-constant" title="Mapi::Pst::BlockPtr::BLOCK_SIZE (constant)">BLOCK_SIZE</a></span></span><span class='comma'>,</span> <span class='kw'>false</span>

	<span class='id identifier rubyid_item_count'>item_count</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="#ITEM_COUNT_OFFSET_64-constant" title="Mapi::Pst::ITEM_COUNT_OFFSET_64 (constant)">ITEM_COUNT_OFFSET_64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#ITEM_COUNT_OFFSET-constant" title="Mapi::Pst::ITEM_COUNT_OFFSET (constant)">ITEM_COUNT_OFFSET</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="#LEVEL_INDICATOR_OFFSET_64-constant" title="Mapi::Pst::LEVEL_INDICATOR_OFFSET_64 (constant)">LEVEL_INDICATOR_OFFSET_64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#LEVEL_INDICATOR_OFFSET-constant" title="Mapi::Pst::LEVEL_INDICATOR_OFFSET (constant)">LEVEL_INDICATOR_OFFSET</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_count_max'>count_max</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#COUNT_MAX64-constant" title="Mapi::Pst::BlockPtr::COUNT_MAX64 (constant)">COUNT_MAX64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#COUNT_MAX32-constant" title="Mapi::Pst::BlockPtr::COUNT_MAX32 (constant)">COUNT_MAX32</a></span></span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>have too many active items in index (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_item_count'>item_count</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_item_count'>item_count</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_count_max'>count_max</span>

	<span class='id identifier rubyid_this_node_id'>this_node_id</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#BACKLINK_OFFSET-constant" title="Mapi::Pst::BACKLINK_OFFSET (constant)">BACKLINK_OFFSET</a></span></span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#BACKLINK_OFFSET-constant" title="Mapi::Pst::BACKLINK_OFFSET (constant)">BACKLINK_OFFSET</a></span></span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 1</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_this_node_id'>this_node_id</span> <span class='op'>==</span> <span class='id identifier rubyid_linku1'>linku1</span>

	<span class='kw'>if</span> <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>0</span>
		<span class='comment'># leaf pointers
</span>		<span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#SIZE64-constant" title="Mapi::Pst::BlockPtr::SIZE64 (constant)">SIZE64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#SIZE32-constant" title="Mapi::Pst::BlockPtr::SIZE32 (constant)">SIZE32</a></span></span>

		<span class='comment'># split the data into item_count index objects
</span>		<span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_split_per'><span class='object_link'><a href="#split_per-class_method" title="Mapi::Pst.split_per (method)">split_per</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_item_count'>item_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/BlockPtr.html#initialize-instance_method" title="Mapi::Pst::BlockPtr#initialize (method)">new</a></span></span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_is64'>is64</span>
			<span class='comment'># first entry
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_start_val'>start_val</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_start_val'>start_val</span>
			<span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_pst'>pst</span> <span class='op'>=</span> <span class='kw'>self</span>
			<span class='comment'># this shouldn&#39;t really happen i&#39;d imagine
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OHNO</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='int'>0</span>
			<span class='ivar'>@blocks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_idx'>idx</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='comment'># node pointers
</span>		<span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/TablePtr.html#SIZE64-constant" title="Mapi::Pst::TablePtr::SIZE64 (constant)">SIZE64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/TablePtr.html#SIZE32-constant" title="Mapi::Pst::TablePtr::SIZE32 (constant)">SIZE32</a></span></span>
		<span class='comment'># split the data into item_count table pointers
</span>		<span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_split_per'><span class='object_link'><a href="#split_per-class_method" title="Mapi::Pst.split_per (method)">split_per</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_item_count'>item_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/TablePtr.html#initialize-instance_method" title="Mapi::Pst::TablePtr#initialize (method)">new</a></span></span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_is64'>is64</span>
			<span class='comment'># for the first value, we expect the start to be equal
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_start_val'>start_val</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='op'>!=</span> <span class='id identifier rubyid_start_val'>start_val</span>
			<span class='comment'># this shouldn&#39;t really happen i&#39;d imagine
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OHNO</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='op'>==</span> <span class='int'>0</span>
			<span class='id identifier rubyid_load_block_tree'>load_block_tree</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_u1'>u1</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_main_block_to-instance_method">
  
    #<strong>load_main_block_to</strong>(block_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>block_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 821</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_main_block_to'>load_main_block_to</span> <span class='id identifier rubyid_block_id'>block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_id'>block_id</span> <span class='op'>==</span> <span class='int'>0</span>

	<span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_block_from_id'>block_from_id</span> <span class='id identifier rubyid_block_id'>block_id</span>

	<span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_data?'>data?</span>
		<span class='comment'># this is real data we want
</span>		<span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BINARY</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>return</span>
	<span class='kw'>end</span>

	<span class='comment'># XBLOCK or XXBLOCK
</span>	<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>

	<span class='id identifier rubyid_btype'>btype</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>btype must be 1</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_btype'>btype</span> <span class='op'>!=</span> <span class='int'>1</span>

	<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='kw'>case</span> <span class='id identifier rubyid_level'>level</span>
	<span class='kw'>when</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span>
		<span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='id identifier rubyid_num_bytes'>num_bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>6</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vV</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

		<span class='id identifier rubyid_items'>items</span> <span class='op'>=</span> <span class='lparen'>(</span>
			<span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>8</span><span class='comma'>,</span> <span class='int'>8</span> <span class='op'>*</span> <span class='id identifier rubyid_count'>count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>8</span><span class='comma'>,</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_count'>count</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='rparen'>)</span>
		<span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_block_id'>block_id</span><span class='op'>|</span>
			<span class='id identifier rubyid_load_main_block_to'>load_main_block_to</span> <span class='id identifier rubyid_block_id'>block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
		<span class='rbrace'>}</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>level unk</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_node_btree-instance_method">
  
    #<strong>load_node_btree</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to</p>
<ul><li>
<p>_pst_build_desc_ptr</p>
</li><li>
<p>record_descriptor</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 570</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_node_btree'>load_node_btree</span>
	<span class='ivar'>@nodes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='ivar'>@node_offsets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_load_node_tree'>load_node_tree</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_node_btree'>node_btree</span><span class='comma'>,</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_node_btree_count'>node_btree_count</span><span class='comma'>,</span> <span class='int'>0x21</span>

	<span class='comment'># first create a lookup cache
</span>	<span class='ivar'>@node_from_id</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
		<span class='ivar'>@nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
		<span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_pst'>pst</span> <span class='op'>=</span> <span class='kw'>self</span>
		<span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>there are duplicate desc records with id </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_node_id'>node_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@node_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_node_id'>node_id</span><span class='rbracket'>]</span>
		<span class='ivar'>@node_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_node_id'>node_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span>
	<span class='kw'>end</span>

	<span class='comment'># now turn the flat list of loaded desc records into a tree
</span>
	<span class='comment'># well, they have no parent, so they&#39;re more like, the toplevel descs.
</span>	<span class='ivar'>@orphans</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='comment'># now assign each node to the parents child array, putting the orphans in the above
</span>	<span class='ivar'>@nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
		<span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='ivar'>@node_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_parent_node_id'>parent_node_id</span><span class='rbracket'>]</span>
		<span class='comment'># note, besides this, its possible to create other circular structures.
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span> <span class='op'>==</span> <span class='id identifier rubyid_node'>node</span>
			<span class='comment'># this actually happens usually, for the root_item it appears.
</span>			<span class='comment'>#warn &quot;desc record&#39;s parent is itself (#{desc.inspect})&quot;
</span>		<span class='comment'># maybe add some more checks in here for circular structures
</span>		<span class='kw'>elsif</span> <span class='id identifier rubyid_parent'>parent</span>
			<span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_node'>node</span>
			<span class='kw'>next</span>
		<span class='kw'>end</span>
		<span class='ivar'>@orphans</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_node'>node</span>
	<span class='kw'>end</span>

	<span class='comment'># maybe change this to some sort of sane-ness check. orphans are expected
</span><span class='comment'>#		warn &quot;have #{@orphans.length} orphan desc record(s).&quot; unless @orphans.empty?
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_node_main_data_to-instance_method">
  
    #<strong>load_node_main_data_to</strong>(node_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>node_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


697
698
699
700
701</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 697</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_node_main_data_to'>load_node_main_data_to</span> <span class='id identifier rubyid_node_id'>node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>node_is must be Integer</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_node_id'>node_id</span>
	<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_node_from_id'>node_from_id</span> <span class='id identifier rubyid_node_id'>node_id</span>
	<span class='id identifier rubyid_load_main_block_to'>load_main_block_to</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_block_id'>block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_node_sub_data_to-instance_method">
  
    #<strong>load_node_sub_data_to</strong>(node_id, local_node_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>node_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>local_node_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


706
707
708
709
710
711</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 706</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_node_sub_data_to'>load_node_sub_data_to</span> <span class='id identifier rubyid_node_id'>node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>node_is must be Integer</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_node_id'>node_id</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>local_node_id must be Integer</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span>
	<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_node_from_id'>node_from_id</span> <span class='id identifier rubyid_node_id'>node_id</span>
	<span class='id identifier rubyid_load_sub_block_to'>load_sub_block_to</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_sub_block_id'>sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_node_tree-instance_method">
  
    #<strong>load_node_tree</strong>(offset, linku1, start_val)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>load the flat list of desc records recursively</p>

<p>corresponds to</p>
<ul><li>
<p>_pst_build_desc_ptr</p>
</li><li>
<p>record_descriptor</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 616</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_node_tree'>load_node_tree</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_linku1'>linku1</span><span class='comma'>,</span> <span class='id identifier rubyid_start_val'>start_val</span>
	<span class='ivar'>@node_offsets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_offset'>offset</span>
	
	<span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_pst_read_block_size'>pst_read_block_size</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#BLOCK_SIZE-constant" title="Mapi::Pst::NodePtr::BLOCK_SIZE (constant)">BLOCK_SIZE</a></span></span><span class='comma'>,</span> <span class='kw'>false</span>
	<span class='id identifier rubyid_item_count'>item_count</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="#ITEM_COUNT_OFFSET_64-constant" title="Mapi::Pst::ITEM_COUNT_OFFSET_64 (constant)">ITEM_COUNT_OFFSET_64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#ITEM_COUNT_OFFSET-constant" title="Mapi::Pst::ITEM_COUNT_OFFSET (constant)">ITEM_COUNT_OFFSET</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="#LEVEL_INDICATOR_OFFSET_64-constant" title="Mapi::Pst::LEVEL_INDICATOR_OFFSET_64 (constant)">LEVEL_INDICATOR_OFFSET_64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#LEVEL_INDICATOR_OFFSET-constant" title="Mapi::Pst::LEVEL_INDICATOR_OFFSET (constant)">LEVEL_INDICATOR_OFFSET</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>

	<span class='comment'># not real desc
</span>	<span class='id identifier rubyid_this_node_id'>this_node_id</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#BACKLINK_OFFSET-constant" title="Mapi::Pst::BACKLINK_OFFSET (constant)">BACKLINK_OFFSET</a></span></span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#BACKLINK_OFFSET-constant" title="Mapi::Pst::BACKLINK_OFFSET (constant)">BACKLINK_OFFSET</a></span></span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 1</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_this_node_id'>this_node_id</span> <span class='op'>==</span> <span class='id identifier rubyid_linku1'>linku1</span>

	<span class='kw'>if</span> <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>0</span>
		<span class='comment'># leaf pointers
</span>		<span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#SIZE64-constant" title="Mapi::Pst::NodePtr::SIZE64 (constant)">SIZE64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#SIZE32-constant" title="Mapi::Pst::NodePtr::SIZE32 (constant)">SIZE32</a></span></span>
		<span class='id identifier rubyid_count_max'>count_max</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#COUNT_MAX64-constant" title="Mapi::Pst::NodePtr::COUNT_MAX64 (constant)">COUNT_MAX64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/NodePtr.html#COUNT_MAX32-constant" title="Mapi::Pst::NodePtr::COUNT_MAX32 (constant)">COUNT_MAX32</a></span></span>

		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>have too many active items in index (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_item_count'>item_count</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_item_count'>item_count</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_count_max'>count_max</span>
		<span class='comment'># split the data into item_count desc objects
</span>		<span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_split_per'><span class='object_link'><a href="#split_per-class_method" title="Mapi::Pst.split_per (method)">split_per</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_item_count'>item_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/NodePtr.html#initialize-instance_method" title="Mapi::Pst::NodePtr#initialize (method)">new</a></span></span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_is64'>is64</span>
			<span class='comment'># first entry
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_start_val'>start_val</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_node_id'>node_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_start_val'>start_val</span>
			<span class='comment'># this shouldn&#39;t really happen i&#39;d imagine
</span>			<span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_node_id'>node_id</span> <span class='op'>==</span> <span class='int'>0</span>
			<span class='ivar'>@nodes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_node'>node</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='comment'># node pointers
</span>		<span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/TablePtr.html#SIZE64-constant" title="Mapi::Pst::TablePtr::SIZE64 (constant)">SIZE64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/TablePtr.html#SIZE32-constant" title="Mapi::Pst::TablePtr::SIZE32 (constant)">SIZE32</a></span></span>
		<span class='id identifier rubyid_count_max'>count_max</span> <span class='op'>=</span> <span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#COUNT_MAX64-constant" title="Mapi::Pst::BlockPtr::COUNT_MAX64 (constant)">COUNT_MAX64</a></span></span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="Pst/BlockPtr.html" title="Mapi::Pst::BlockPtr (class)">BlockPtr</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Pst/BlockPtr.html#COUNT_MAX32-constant" title="Mapi::Pst::BlockPtr::COUNT_MAX32 (constant)">COUNT_MAX32</a></span></span>

		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>have too many active items in index (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_item_count'>item_count</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_item_count'>item_count</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_count_max'>count_max</span>
		<span class='comment'># split the data into item_count table pointers
</span>		<span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_split_per'><span class='object_link'><a href="#split_per-class_method" title="Mapi::Pst.split_per (method)">split_per</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_item_count'>item_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Pst/TablePtr.html" title="Mapi::Pst::TablePtr (class)">TablePtr</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/TablePtr.html#initialize-instance_method" title="Mapi::Pst::TablePtr#initialize (method)">new</a></span></span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_is64'>is64</span>
			<span class='comment'># for the first value, we expect the start to be equal note that ids -1, so even for the
</span>			<span class='comment'># first we expect it to be equal. thats the 0x21 (dec 33) desc record. this means we assert
</span>			<span class='comment'># that the first desc record is always 33...
</span>			<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blah 3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_start_val'>start_val</span> <span class='op'>!=</span> <span class='op'>-</span><span class='int'>1</span> <span class='kw'>and</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='op'>!=</span> <span class='id identifier rubyid_start_val'>start_val</span>
			<span class='comment'># this shouldn&#39;t really happen i&#39;d imagine
</span>			<span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='op'>==</span> <span class='int'>0</span>
			<span class='id identifier rubyid_load_node_tree'>load_node_tree</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_u1'>u1</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_sub_block_to-instance_method">
  
    #<strong>load_sub_block_to</strong>(sub_block_id, local_node_id, list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sub_block_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>local_node_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>list</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 769</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_sub_block_to'>load_sub_block_to</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sub_block_id must be Integer</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span>
	<span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span> <span class='op'>==</span> <span class='int'>0</span>

	<span class='id identifier rubyid_sub_block'>sub_block</span> <span class='op'>=</span> <span class='id identifier rubyid_block_from_id'>block_from_id</span> <span class='id identifier rubyid_sub_block_id'>sub_block_id</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>must not be data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_data?'>data?</span>

	<span class='comment'># SLBLOCK or SIBLOCK
</span>	<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>

	<span class='id identifier rubyid_btype'>btype</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>btype != 2</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_btype'>btype</span> <span class='op'>!=</span> <span class='int'>2</span>

	<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>
	<span class='kw'>case</span> <span class='id identifier rubyid_level'>level</span>
	<span class='kw'>when</span> <span class='int'>0</span> <span class='comment'># SLBLOCK
</span>		<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>v</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_sl_node_id'>sl_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_sl_block_id'>sl_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_sl_sub_block_id'>sl_sub_block_id</span> <span class='op'>=</span> <span class='lparen'>(</span>
				<span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>24</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>24</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>12</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>12</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='rparen'>)</span>

			<span class='id identifier rubyid_sl_node_id'>sl_node_id</span> <span class='op'>&amp;=</span> <span class='int'>0xffffffff</span>
			
			<span class='kw'>if</span> <span class='id identifier rubyid_sl_node_id'>sl_node_id</span> <span class='op'>==</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span>
				<span class='id identifier rubyid_load_main_block_to'>load_main_block_to</span> <span class='id identifier rubyid_sl_block_id'>sl_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
			<span class='kw'>end</span>

			<span class='id identifier rubyid_load_sub_block_to'>load_sub_block_to</span> <span class='id identifier rubyid_sl_sub_block_id'>sl_sub_block_id</span><span class='comma'>,</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_list'>list</span>
		<span class='kw'>end</span>
	<span class='kw'>when</span> <span class='int'>1</span> <span class='comment'># SIBLOCK
</span>		<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>v</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
		<span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
			<span class='id identifier rubyid_si_node_id'>si_node_id</span><span class='comma'>,</span> <span class='id identifier rubyid_si_block_id'>si_block_id</span> <span class='op'>=</span> <span class='lparen'>(</span>
				<span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="" title="Mapi::Pst (class)">Pst</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unpack'><span class='object_link'><a href="#unpack-class_method" title="Mapi::Pst.unpack (method)">unpack</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>16</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>T2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_is64'>is64</span> <span class='op'>?</span> <span class='int'>8</span> <span class='op'>:</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>8</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='rparen'>)</span>

			<span class='id identifier rubyid_si_node_id'>si_node_id</span> <span class='op'>&amp;=</span> <span class='int'>0xffffffff</span>

			<span class='kw'>if</span> <span class='id identifier rubyid_si_node_id'>si_node_id</span> <span class='op'>==</span> <span class='id identifier rubyid_local_node_id'>local_node_id</span>
				<span class='id identifier rubyid_si_block'>si_block</span> <span class='op'>=</span> <span class='id identifier rubyid_block_from_id'>block_from_id</span> <span class='id identifier rubyid_si_block_id'>si_block_id</span>
				<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>must be data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_si_block'>si_block</span><span class='period'>.</span><span class='id identifier rubyid_data?'>data?</span>
				<span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_si_block'>si_block</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BINARY</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>level unk</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_xattrib-instance_method">
  
    #<strong>load_xattrib</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to</p>
<ul><li>
<p>pst_load_extended_attributes</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


675
676</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 675</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_xattrib'>load_xattrib</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    #<strong>name</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1831
1832
1833</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1831</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
	<span class='ivar'>@name</span> <span class='op'>||=</span> <span class='id identifier rubyid_root_item'>root_item</span><span class='period'>.</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_display_name'>display_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="node_from_id-instance_method">
  
    #<strong>node_from_id</strong>(id)  &#x21d2; <tt><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>as for idx</p>

<p>corresponds to:</p>
<ul><li>
<p>_pst_getDptr</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


669
670
671</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 669</span>

<span class='kw'>def</span> <span class='id identifier rubyid_node_from_id'>node_from_id</span> <span class='id identifier rubyid_id'>id</span>
	<span class='ivar'>@node_from_id</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pst_parse_item-instance_method">
  
    #<strong>pst_parse_item</strong>(node)  &#x21d2; <tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to</p>
<ul><li>
<p>_pst_parse_item</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>desc</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1711
1712
1713</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1711</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pst_parse_item'>pst_parse_item</span> <span class='id identifier rubyid_node'>node</span>
	<span class='const'><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/Item.html#initialize-instance_method" title="Mapi::Pst::Item#initialize (method)">new</a></span></span> <span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Pst/RawPropertyStore.html" title="Mapi::Pst::RawPropertyStore (class)">RawPropertyStore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Pst/RawPropertyStore.html#initialize-instance_method" title="Mapi::Pst::RawPropertyStore#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pst_read_block_size-instance_method">
  
    #<strong>pst_read_block_size</strong>(offset, size, decrypt = true)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>corresponds to:</p>
<ul><li>
<p>_pst_read_block_size</p>
</li><li>
<p>_pst_read_block ??</p>
</li><li>
<p>_pst_ff_getIDblock_dec ??</p>
</li><li>
<p>_pst_ff_getIDblock ??</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>offset</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>size</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>decrypt</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


688
689
690
691
692
693</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 688</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pst_read_block_size'>pst_read_block_size</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='op'>=</span><span class='kw'>true</span>
	<span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span> <span class='id identifier rubyid_offset'>offset</span>
	<span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='id identifier rubyid_size'>size</span>
	<span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tried to read </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> bytes but only got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='id identifier rubyid_size'>size</span>
	<span class='id identifier rubyid_encrypted?'>encrypted?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_decrypt'>decrypt</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Pst/CompressibleEncryption.html" title="Mapi::Pst::CompressibleEncryption (class)">CompressibleEncryption</a></span></span><span class='period'>.</span><span class='id identifier rubyid_decrypt'><span class='object_link'><a href="Pst/CompressibleEncryption.html#decrypt-class_method" title="Mapi::Pst::CompressibleEncryption.decrypt (method)">decrypt</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_buf'>buf</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root-instance_method">
  
    #<strong>root</strong>  &#x21d2; <tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1818
1819
1820</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1818</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root'><span class='object_link'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span>
	<span class='id identifier rubyid_root_item'>root_item</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root_desc-instance_method">
  
    #<strong>root_desc</strong>  &#x21d2; <tt><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/NodePtr.html" title="Mapi::Pst::NodePtr (class)">NodePtr</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1806
1807
1808</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1806</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root_desc'>root_desc</span>
	<span class='ivar'>@nodes</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root_item-instance_method">
  
    #<strong>root_item</strong>  &#x21d2; <tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Item</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1811
1812
1813
1814
1815</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 1811</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root_item'>root_item</span>
	<span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_pst_parse_item'>pst_parse_item</span> <span class='id identifier rubyid_root_desc'>root_desc</span>
	<span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='symbol'>:root</span>
	<span class='id identifier rubyid_item'>item</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="warn-instance_method">
  
    #<strong>warn</strong>(s)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>until i properly fix logging…</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/pst.rb', line 314</span>

<span class='kw'>def</span> <span class='id identifier rubyid_warn'>warn</span> <span class='id identifier rubyid_s'>s</span>
	<span class='const'><span class='object_link'><a href="../Mapi.html" title="Mapi (module)">Mapi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='id identifier rubyid_s'>s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Dec 24 22:03:38 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.6.5).
</div>

    </div>
  </body>
</html>